<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ОФЗ</title>
    <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const E of o.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&e(E)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();const d=["ISIN","SECNAME","COUPONPERCENT","COUPONVALUE","ACCRUEDINT","COUPONPERIOD","NEXTCOUPON","PREVLEGALCLOSEPRICE"],c=["LAST"],l=`https://iss.moex.com/iss/engines/stock/markets/bonds/boards/TQOB/securities.json?iss.json=extended&iss.meta=off&iss.only=securities,marketdata&securities.columns=${d.join()}&marketdata.columns=${c.join()}`;async function a(){const n=await fetch(l),{securities:t,marketdata:i}=(await n.json())[1];return t.filter((e,s)=>{if(e.SECNAME.startsWith("ОФЗ-ПД")||e.SECNAME.startsWith("ОФЗ-ПК"))return e.PRICE=i[s].LAST||e.PREVLEGALCLOSEPRICE||0,e.YIELD=e.PRICE&&e.COUPONPERCENT?e.COUPONPERCENT/e.PRICE*100:0,e.YIELDCLEAN=e.YIELD?e.YIELD*.87:0,e.NEXTCOUPON=new Date(e.NEXTCOUPON),e.NKDPERC=e.COUPONVALUE?100*e.ACCRUEDINT/e.COUPONVALUE:0,delete e.ACCRUEDINT,delete e.COUPONVALUE,delete e.COUPONPERCENT,delete e.PREVLEGALCLOSEPRICE,e})}function C(n,t){const i=document.getElementById("tbody");i.innerHTML="",n.forEach(e=>{const s=t.has(e.ISIN)?t.get(e.ISIN).select:!1,o=`
      <tr id="${e.ISIN}" class="${s?"select":""}">
        <td>${e.SECNAME}</td>
        <td>${e.YIELDCLEAN?e.YIELDCLEAN.toFixed(2):""}</td>
        <td>${e.YIELD?e.YIELD.toFixed(2):""}</td>
        <td>${e.PRICE.toFixed(2)}</td>
        <td>${e.NEXTCOUPON.toISOString().split("T")[0]}</td>
        <td>${e.NKDPERC?e.NKDPERC.toFixed(0):""}</td>
      </tr>`;i.insertAdjacentHTML("beforeend",o)})}function L(n,t){return!isFinite(t.YIELD)&&!isFinite(n.YIELD)?0:isFinite(t.YIELD)?isFinite(n.YIELD)?t.YIELD-n.YIELD:-1:1}const r=new Map;document.getElementById("tbody").onclick=n=>{const t=n.target.closest("tr");r.has(t.id)?(r.get(t.id).select=!r.get(t.id).select,t.classList.toggle("select")):(r.set(t.id,{select:!0}),t.classList.add("select"))};(async function n(){const t=await a();t.sort(L),C(t,r),setTimeout(n,1e4)})();
</script>
    <style rel="stylesheet" crossorigin>*{padding:0;margin:0;font-family:monospace,system-ui,Arial,sans-serif}th,td{text-align:left;padding:10px;border-bottom:.1px solid #eee}td{color:#444}th{position:-webkit-sticky;position:sticky;top:0;background-color:#444;border:.1px solid #444;color:#fff}table{width:100%;border-collapse:separate;border-spacing:0;column-width:100px}.select{background-color:#7fffd4}
</style>
  </head>

  <body>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>YieldT</th>
          <th>Yield</th>
          <th>Price</th>
          <th>Next coupon</th>
          <th>Accrued, %</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </body>
</html>
